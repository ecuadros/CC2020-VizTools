<dx-toolbar>
  <dxi-item location="after" widget="dxButton" locateInMenu="never">
    <div *dxTemplate>
      <div class='toolbar-label'><b>Program</b></div>
    </div>
  </dxi-item>
  <dxi-item location="after" widget="dxButton" locateInMenu="never">
    <div *dxTemplate>
      <dx-select-box id="selectbox" [items]="programPD" displayExpr="name" (onValueChanged)="onProgramSelected($event)"
        style="width: 250px">
      </dx-select-box>
    </div>
  </dxi-item>
  <dxi-item location="after" widget="dxButton" locateInMenu="never" [options]="addProgramButton">
  </dxi-item>
</dx-toolbar>

<dx-chart id="chart" palette="material" title="{{programSelected}}" [dataSource]="chartPD">
  <dxo-subtitle text="(Subtitle)"></dxo-subtitle>
  <dxo-common-series-settings argumentField="dkaTitle" type="rangeArea">
  </dxo-common-series-settings>
  <dxi-value-axis [tickInterval]="1" [valueMarginsEnabled]="false">
  </dxi-value-axis>
  <dxo-argument-axis [valueMarginsEnabled]="false">
    <dxo-label wordWrap="none" overlappingBehavior="rotate"></dxo-label>
  </dxo-argument-axis>
  <dxo-legend [visible]="false"></dxo-legend>
  <dxi-series rangeValue1Field="min" rangeValue2Field="max" name="id"></dxi-series>
</dx-chart>

<div class="dx-fieldset">
  <div class="dx-field">
    <div class="dx-field-label">Program DropDownBox</div>
    <div class="dx-field-value">
      <dx-drop-down-box [(value)]="programBoxValue" valueExpr="id" displayExpr="name" placeholder="Select program..."
        [items]="programPD" (onValueChanged)="syncProgramViewSelection($event)">

        <div *dxTemplate="let data of 'content'">
          <dx-tree-view [items]="programPD" dataStructure="plain" keyExpr="id" selectionMode="multiple"
            showCheckBoxesMode="normal" [selectNodesRecursive]="false" displayExpr="name" [selectByClick]="true"
            (onContentReady)="syncProgramViewSelection($event)"
            (onItemSelectionChanged)="treeView_itemSelectionChanged($event)" selectedExpr="selected">
            <div *dxTemplate="let item of 'item'">
              {{ item.name + ' (' + item.acronym + ')' }}
            </div>
          </dx-tree-view>
        </div>
      </dx-drop-down-box>
    </div>
  </div>
</div>

<dx-data-grid id="gridContainer" [dataSource]="chartDS" [showColumnLines]="true" [showRowLines]="true"
  [showBorders]="true" [height]="500" [rowAlternationEnabled]="true" [columnAutoWidth]="true"
  (onRowUpdating)="onRowUpdating($event)" (onRowClick)="onRowClick($event)" (onEditorPreparing) = "onEditorPreparing($event)">


  <dxo-editing [allowUpdating]="true" [allowAdding]="false" [allowDeleting]="false" [selectTextOnEditStart]="true"
    [useIcons]="true" mode="cell">
  </dxo-editing>

  <dxo-grouping [allowCollapsing]="false" [contextMenuEnabled]="true" expandMode="rowClick"></dxo-grouping>
  <dxo-group-panel [visible]="false" emptyPanelText="Relative Weights of Computing Knowledge Areas"></dxo-group-panel>

  <dxi-column dataField="id" [allowEditing]="false" [visible]="false"></dxi-column>

  <dxi-column dataField="dkagTitle" [allowEditing]="false" [groupIndex]="0" caption="" [sortIndex]="0" sortOrder="asc"
    [calculateCellValue]="onAddDKAGPrefix">
  </dxi-column>

  <dxi-column dataField="dkaIndex" [sortIndex]="1" sortOrder="asc" [visible]="false">
  </dxi-column>

  <dxi-column dataField="dkaIndex" caption="Index" [width]="50" [allowEditing]="false" [visible]="true"
    [calculateCellValue]="onAddDKAPrefix">
  </dxi-column>

  <dxi-column dataField="dkaTitle" cellTemplate="cellTemplate" caption="Discipline Knowledge Area">
    <dxi-validation-rule type="required" message="DKA Title is required"></dxi-validation-rule>
  </dxi-column>
  <div *dxTemplate="let cell of 'cellTemplate'">
    <div class="dka-cell" [ngClass]="cell.value=='(new)'?'new-cell':''">
      {{cell.value}}
      <div *ngIf="cell.value!='(new)'" class="trash dx-command-edit dx-command-edit-with-icons ">
        <a (click)="removeDKA(cell.data)" class="dx-link dx-link-delete dx-icon-trash dx-link-icon trash-icon"
          title="Delete" aria-label="Delete"></a>
      </div>
    </div>
  </div>

  <ng-container *ngFor="let program of selectedPrograms">
    <dxi-column alignment="center" [caption]="program.name">
      <dxi-column alignment="center" [width]="50" caption="Min" [dataField]="program.id + '_min'" [allowEditing]="true"
        [visible]="true">
        <dxi-validation-rule type="required"></dxi-validation-rule>
      </dxi-column>

      <dxi-column alignment="center" [width]="50" caption="Max" [dataField]="program.id + '_max'" [allowEditing]="true"
        [visible]="true">
        <dxi-validation-rule type="required"></dxi-validation-rule>
      </dxi-column>
    </dxi-column>
  </ng-container>

  <dxo-search-panel [visible]="false"></dxo-search-panel>
  <dxo-grouping #expand [autoExpandAll]="true"></dxo-grouping>
  <dxo-paging [enabled]="false"></dxo-paging>
  <dxo-scrolling mode="virtual" columnRenderingMode="virtual"></dxo-scrolling>
</dx-data-grid>

<dx-popup show-title="true" title="Edit DKAG" [(visible)]="isVisibleDKAGPopup" [dragEnabled]="false"
  [closeOnOutsideClick]="true" [width]="400" [height]="180">
  <div *dxTemplate="let data of 'content'">
    <dx-form [formData]="dkagForm">
      <dxi-item dataField="name">
        <dxi-validation-rule type="required" message="Name is required"></dxi-validation-rule>
      </dxi-item>
    </dx-form>
    <dx-button stylingMode="contained" text="Save" type="default" [width]="120" style="margin-top: 10px;"
      (onClick)="onSubmitDKAG($event)">
    </dx-button>
  </div>
</dx-popup>

<dx-popup show-title="true" title="New Program" [(visible)]="isVisibleProgramPopup" [dragEnabled]="false"
  [closeOnOutsideClick]="true" [width]="400" [height]="220">
  <div *dxTemplate="let data of 'content'">
    <dx-form [formData]="programForm">
      <dxi-item dataField="name">
        <dxi-validation-rule type="required" message="Name is required"></dxi-validation-rule>
      </dxi-item>
      <dxi-item dataField="acronym">
        <dxi-validation-rule type="required" message="Acronym is required"></dxi-validation-rule>
      </dxi-item>

    </dx-form>
    <dx-button stylingMode="contained" text="Save" type="default" [width]="120" style="margin-top: 10px;"
      (onClick)="onSubmitProgram($event)">
    </dx-button>
  </div>
</dx-popup>